<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AJA NTV2 SDK: Sharing AJA Devices With Other Applications</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../ajastyles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../AJALogoMini.jpg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AJA NTV2 SDK
   &#160;<span id="projectnumber">17.1.3.1410</span>
   </div>
   <div id="projectbrief">NTV2 SDK 17.1.3.1410</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('dc/d29/devicesharing.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Sharing AJA Devices With Other Applications </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>If itʼs possible that your OEM application might coexist with another AJA-aware application on the host computer, itʼs likely neither application will run correctly if they both attempt to control the same AJA device at the same time.</p>
<p>Once your application has found the device it needs to use, AJA strongly recommends obtaining exclusive use of it to prevent collisions with other applications, including AJAʼs own utilities and applications.</p>
<h1><a class="anchor" id="devshareagent"></a>
The AJA “Retail” Agent</h1>
<p>When AJA’s “retail” software is installed, it provides an agent that manages device ownership and provides convenient device widget routing and configuration services to “retail” client applications (e.g., Adobe, Avid, QuickTime, etc.). It also configures attached devices to a reasonable default state, or to a preferred state as configured by the user via the <b>AJA ControlPanel</b> application.</p>
<div class="image">
<img src="../../ajacontrolpanel.png" alt=""/>
</div>
<p>The <b>ControlPanel</b> provides a user interface for end-users to set default routing, conversions, and other device settings. It communicates configuration changes to the AJA agent through a database stored on the hostʼs file system. The agent enforces the settings stored in the database in an “every frame” task that’s called at every VBI interval.</p>
<p>Prior to AJA software version 17.0, the agent was implemented as a separate process:</p><ul>
<li>an agent on <b>macOS</b>;</li>
<li>a system service on <b>Windows</b>;</li>
<li>a daemon on <b>Linux</b>.</li>
</ul>
<p>In AJA software version 17.0, the agent service was moved into the <b>ControlPanel</b> application.</p><ul>
<li>It presents an icon and context menu in the system “tray” (Windows, Linux) or menu bar (macOS).</li>
<li>The AJA “retail” installer configures the host operating system to automatically launch the <b>ControlPanel</b> upon user login.</li>
<li>It starts and runs one agent thread per attached device.</li>
<li>The device agent (thread) continues to run, even if the <b>ControlPanel</b> window is closed.</li>
</ul>
<p>If an application sets the task mode (using <a class="el" href="../../d7/dfb/class_c_n_t_v2_card.html#ad25fe233858f35998fd06d8d3fbcd958" title="Sets the device&#39;s task mode.">CNTV2Card::SetEveryFrameServices</a>) to <a class="el" href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27eaa297897e1aceeb9f27b3cb7de8a0b588e" title="2: OEM: Device is configured by controlling application(s), with minimal driver involvement.">NTV2_OEM_TASKS</a> for a particular device, the agent servicing that device bows out, and stops controlling it.</p>
<dl class="section note"><dt>Note</dt><dd>AJA does not provide a public API for interrogating or controlling the <b>ControlPanel</b> settings.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>OEM applications must not rely on <b>ControlPanel</b> behavior, nor on any device configuration that results from any <b>ControlPanel</b> settings, as these are subject to change without notice. OEM applications must configure the AJA device(s) to meet their application requirements using APIs provided in the NTV2 SDK.</dd></dl>
<p>Some OEM developers require their application to operate on Linux or Windows without AJA “retail” software installed. This is still supported in version 17.0.</p>
<h1><a class="anchor" id="devshareisinuse"></a>
Determining if an AJA Device is Being Used</h1>
<p>To determine if an AJA device is being used by another application, whether it be an OEM application, or one that uses the Control Panel services, application writers should call <a class="el" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a9b22c60b42e0ee624b557cb9fb6e657e" title="Answers with the four-CC type and process ID of the application that currently &quot;owns&quot; the AJA device ...">CNTV2Card::GetStreamingApplication</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="../../d7/dfb/class_c_n_t_v2_card.html">CNTV2Card</a>   theDevice;</div>
<div class="line">. . .</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  Is an application using the device?</span></div>
<div class="line">ULWord   appFourCC (<a class="code" href="../../d9/d49/types_8h.html#aeddfab0de48ab981f183d7c774d0c2e0">AJA_FOURCC</a> (<span class="charliteral">&#39;?&#39;</span>, <span class="charliteral">&#39;?&#39;</span>, <span class="charliteral">&#39;?&#39;</span>, <span class="charliteral">&#39;?&#39;</span>));</div>
<div class="line">int32_t  appPID    (0);</div>
<div class="line">theDevice.<a class="code" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a9b22c60b42e0ee624b557cb9fb6e657e">GetStreamingApplication</a> (&amp;appFourCC, &amp;appPID);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (appPID)</div>
<div class="line">{</div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Device is being used by process &quot;</span> &lt;&lt; appPID &lt;&lt; endl;</div>
<div class="line">    <span class="comment">//  Note that the &quot;appFourCC&quot; typically contains a human-readable 4-character &quot;string&quot; that identifies the</span></div>
<div class="line">    <span class="comment">//  application thatʼs controlling the device, e.g., &#39;EnGr&#39; is AJA Control Room, &#39;AJAT&#39; is AJA System Test, etc.</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span></div>
<div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;Device is available&quot;</span> &lt;&lt; endl;</div>
</div><!-- fragment --><h1><a class="anchor" id="devshareacquire"></a>
Acquiring Exclusive Use of an AJA Device</h1>
<p>To acquire and release exclusive use of an AJA device, OEM application writers must call <a class="el" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a86c9b1160fa7aa8a7d52efa7c65331b6" title="Reserves exclusive use of the AJA device for a given process, preventing other processes on the host ...">CNTV2Card::AcquireStreamForApplication</a> or <a class="el" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a370f24dd8c322dd3caceb233d4668ff3" title="Releases exclusive use of the AJA device for the given process, permitting other processes to acquire...">CNTV2Card::ReleaseStreamForApplication</a>, respectively.</p>
<div class="fragment"><div class="line"><span class="comment">//  Give my application a unique 4-character &quot;signature&quot;...</span></div>
<div class="line"><span class="keyword">const</span> uint32_t <a class="code" href="../../d5/dd5/ntv2burn_8cpp.html#a328580ade50e0f7d12a29647a3b88d87">kAppSignature</a> (<a class="code" href="../../d9/d49/types_8h.html#aeddfab0de48ab981f183d7c774d0c2e0">AJA_FOURCC</a> (<span class="charliteral">&#39;s&#39;</span>,<span class="charliteral">&#39;i&#39;</span>,<span class="charliteral">&#39;g&#39;</span>,<span class="charliteral">&#39;n&#39;</span>));</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  Attempt to gain exclusive use of the AJA device...</span></div>
<div class="line"><span class="keyword">const</span> uint32_t appPID (<span class="keyword">static_cast &lt;</span>uint32_t<span class="keyword">&gt;</span> (<a class="code" href="../../d7/d19/class_a_j_a_process.html#a3aa2249cefb9f5f287bfe7758c369c84">AJAProcess::GetPid</a> ()));</div>
<div class="line"><span class="keywordflow">if</span> (theDevice.<a class="code" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a86c9b1160fa7aa8a7d52efa7c65331b6">AcquireStreamForApplication</a> (<a class="code" href="../../d5/dd5/ntv2burn_8cpp.html#a328580ade50e0f7d12a29647a3b88d87">kAppSignature</a>, appPID))</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//  My app now has exclusive use of the AJA device!</span></div>
<div class="line">    RunMyApplicationUsingDevice (theDevice);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//  Iʼm done, so I can relinquish my exclusive use of it...</span></div>
<div class="line">    theDevice.<a class="code" href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a370f24dd8c322dd3caceb233d4668ff3">ReleaseStreamForApplication</a> (<a class="code" href="../../d5/dd5/ntv2burn_8cpp.html#a328580ade50e0f7d12a29647a3b88d87">kAppSignature</a>, appPID);</div>
<div class="line">}  <span class="comment">//  if acquired ok</span></div>
</div><!-- fragment --><h1><a class="anchor" id="devsharefullcontrol"></a>
Getting Full Control Over Device Configuration</h1>
<p>In addition to ensuring that other applications wonʼt use use the same AJA device, many applications often need to configure the device differently than the Control Panel settings dictate. These applications must disable the retail (<b>AJA ControlPanel</b>) services by running in “OEM mode”, which is done by calling <a class="el" href="../../d7/dfb/class_c_n_t_v2_card.html#ad25fe233858f35998fd06d8d3fbcd958" title="Sets the device&#39;s task mode.">CNTV2Card::SetEveryFrameServices</a>, passing it <a class="el" href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27eaa297897e1aceeb9f27b3cb7de8a0b588e" title="2: OEM: Device is configured by controlling application(s), with minimal driver involvement.">NTV2_OEM_TASKS</a>. To be a good citizen, before changing this setting, the old setting should be saved (by calling <a class="el" href="../../d7/dfb/class_c_n_t_v2_card.html#a5a677b37d4abd7daac45c537fa285ac8" title="Retrieves the device&#39;s current &quot;retail service&quot; task mode.">CNTV2Card::GetEveryFrameServices</a>) and restored when the device is released.</p>
<div class="fragment"><div class="line"><a class="code" href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27ea">NTV2EveryFrameTaskMode</a>   savedTaskMode;</div>
<div class="line">. . .</div>
<div class="line">theDevice.GetEveryFrameServices (&amp;savedTaskMode);</div>
<div class="line">theDevice.<a class="code" href="../../d7/dfb/class_c_n_t_v2_card.html#ad25fe233858f35998fd06d8d3fbcd958">SetEveryFrameServices</a> (<a class="code" href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27eaa297897e1aceeb9f27b3cb7de8a0b588e">NTV2_OEM_TASKS</a>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  My app can now configure the AJA device any way it wants,</span></div>
<div class="line"><span class="comment">//  without any interference from the retail services!</span></div>
<div class="line">RunMyApplicationUsingDevice (theDevice);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//  I&#39;m done, so I can restore the previous task mode...</span></div>
<div class="line">theDevice.<a class="code" href="../../d7/dfb/class_c_n_t_v2_card.html#a5a677b37d4abd7daac45c537fa285ac8">GetEveryFrameServices</a> (savedTaskMode);</div>
</div><!-- fragment --><p>The demonstration applications all use these techniques, and can be used as “best practice” examples.</p>
<h1><a class="anchor" id="devshareprocessfam"></a>
Reserving Exclusive Use of a Device by a “Process Family”</h1>
<p>Some applications may require several programs that run concurrently, all using the same AJA device. For example, there may be one capture or playout process instance running for each AutoCirculate channel thatʼs available on the device.</p>
<p>In this case, AJA recommends using a controlling (parent) process that does the following:</p><ul>
<li>Acquires the AJA device.</li>
<li>Launches subordinate per-channel capture/playout (child) processes, including allocating AutoCirculate channels and device frame buffers to child processes (and communicating these parameters to them).</li>
<li>Detects if/when child processes terminate (or crash), including deallocating AutoCirculate channels and device frame buffers.</li>
<li>Releases the AJA device only when all child processes using it have terminated. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="aclass_c_n_t_v2_mac_driver_interface_html_a370f24dd8c322dd3caceb233d4668ff3"><div class="ttname"><a href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a370f24dd8c322dd3caceb233d4668ff3">CNTV2MacDriverInterface::ReleaseStreamForApplication</a></div><div class="ttdeci">virtual bool ReleaseStreamForApplication(ULWord inApplicationType, int32_t inProcessID)</div><div class="ttdoc">Releases exclusive use of the AJA device for the given process, permitting other processes to acquire...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbf/ntv2macdriverinterface_8cpp_source.html#l00516">ntv2macdriverinterface.cpp:516</a></div></div>
<div class="ttc" id="atypes_8h_html_aeddfab0de48ab981f183d7c774d0c2e0"><div class="ttname"><a href="../../d9/d49/types_8h.html#aeddfab0de48ab981f183d7c774d0c2e0">AJA_FOURCC</a></div><div class="ttdeci">#define AJA_FOURCC(a, b, c, d)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d49/types_8h_source.html#l00357">types.h:357</a></div></div>
<div class="ttc" id="aclass_c_n_t_v2_mac_driver_interface_html_a9b22c60b42e0ee624b557cb9fb6e657e"><div class="ttname"><a href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a9b22c60b42e0ee624b557cb9fb6e657e">CNTV2MacDriverInterface::GetStreamingApplication</a></div><div class="ttdeci">virtual bool GetStreamingApplication(ULWord &amp;outAppType, int32_t &amp;outProcessID)</div><div class="ttdoc">Answers with the four-CC type and process ID of the application that currently &quot;owns&quot; the AJA device ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbf/ntv2macdriverinterface_8cpp_source.html#l00651">ntv2macdriverinterface.cpp:651</a></div></div>
<div class="ttc" id="aclass_a_j_a_process_html_a3aa2249cefb9f5f287bfe7758c369c84"><div class="ttname"><a href="../../d7/d19/class_a_j_a_process.html#a3aa2249cefb9f5f287bfe7758c369c84">AJAProcess::GetPid</a></div><div class="ttdeci">static uint64_t GetPid()</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d4c/process_8cpp_source.html#l00035">process.cpp:35</a></div></div>
<div class="ttc" id="aclass_c_n_t_v2_card_html"><div class="ttname"><a href="../../d7/dfb/class_c_n_t_v2_card.html">CNTV2Card</a></div><div class="ttdoc">I interrogate and control an AJA video/audio capture/playout device.</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d4b/ntv2card_8h_source.html#l00028">ntv2card.h:28</a></div></div>
<div class="ttc" id="aclass_c_n_t_v2_card_html_ad25fe233858f35998fd06d8d3fbcd958"><div class="ttname"><a href="../../d7/dfb/class_c_n_t_v2_card.html#ad25fe233858f35998fd06d8d3fbcd958">CNTV2Card::SetEveryFrameServices</a></div><div class="ttdeci">virtual bool SetEveryFrameServices(const NTV2EveryFrameTaskMode inMode)</div><div class="ttdoc">Sets the device's task mode.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/da9/ntv2register_8cpp_source.html#l00179">ntv2register.cpp:179</a></div></div>
<div class="ttc" id="aclass_c_n_t_v2_mac_driver_interface_html_a86c9b1160fa7aa8a7d52efa7c65331b6"><div class="ttname"><a href="../../dc/dfc/class_c_n_t_v2_mac_driver_interface.html#a86c9b1160fa7aa8a7d52efa7c65331b6">CNTV2MacDriverInterface::AcquireStreamForApplication</a></div><div class="ttdeci">virtual bool AcquireStreamForApplication(ULWord inApplicationType, int32_t inProcessID)</div><div class="ttdoc">Reserves exclusive use of the AJA device for a given process, preventing other processes on the host ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dbf/ntv2macdriverinterface_8cpp_source.html#l00481">ntv2macdriverinterface.cpp:481</a></div></div>
<div class="ttc" id="antv2publicinterface_8h_html_ad0b318380537ba7609efe35b3dce27ea"><div class="ttname"><a href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27ea">NTV2EveryFrameTaskMode</a></div><div class="ttdeci">NTV2EveryFrameTaskMode</div><div class="ttdoc">Describes the task mode state. See also: Sharing AJA Devices With Other Applications.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dd7/ntv2publicinterface_8h_source.html#l04288">ntv2publicinterface.h:4288</a></div></div>
<div class="ttc" id="aclass_c_n_t_v2_card_html_a5a677b37d4abd7daac45c537fa285ac8"><div class="ttname"><a href="../../d7/dfb/class_c_n_t_v2_card.html#a5a677b37d4abd7daac45c537fa285ac8">CNTV2Card::GetEveryFrameServices</a></div><div class="ttdeci">virtual bool GetEveryFrameServices(NTV2EveryFrameTaskMode &amp;outMode)</div><div class="ttdoc">Retrieves the device's current &quot;retail service&quot; task mode.</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/da9/ntv2register_8cpp_source.html#l00184">ntv2register.cpp:184</a></div></div>
<div class="ttc" id="antv2burn_8cpp_html_a328580ade50e0f7d12a29647a3b88d87"><div class="ttname"><a href="../../d5/dd5/ntv2burn_8cpp.html#a328580ade50e0f7d12a29647a3b88d87">kAppSignature</a></div><div class="ttdeci">static const uint32_t kAppSignature(((((uint32_t)( 'B'))&lt;&lt; 24)|(((uint32_t)( 'u'))&lt;&lt; 16)|(((uint32_t)( 'r'))&lt;&lt; 8)|(((uint32_t)( 'n'))&lt;&lt; 0)))</div></div>
<div class="ttc" id="antv2publicinterface_8h_html_ad0b318380537ba7609efe35b3dce27eaa297897e1aceeb9f27b3cb7de8a0b588e"><div class="ttname"><a href="../../d4/dd7/ntv2publicinterface_8h.html#ad0b318380537ba7609efe35b3dce27eaa297897e1aceeb9f27b3cb7de8a0b588e">NTV2_OEM_TASKS</a></div><div class="ttdeci">@ NTV2_OEM_TASKS</div><div class="ttdoc">2: OEM: Device is configured by controlling application(s), with minimal driver involvement.</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dd7/ntv2publicinterface_8h_source.html#l04292">ntv2publicinterface.h:4292</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../index.html">The NTV2 SDK</a></li>
    <li class="footer">Generated on Tue Dec 3 2024 10:26:09 for AJA NTV2 SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
